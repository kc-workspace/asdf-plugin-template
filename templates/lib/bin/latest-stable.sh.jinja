#!/usr/bin/env bash

__asdf_bin() {
  local query="$1" def_query="[0-9]"
  if [[ "$query" == "$def_query" ]]; then
    kc_asdf_debug "try get latest version from github"
    if kc_asdf_gh_latest; then
      return 0
    fi
  fi

  kc_asdf_debug "fallback '%s' mode to resolve latest" "tail"

  local tmpfile filter="^\\s*{{ app_version_prefix }}"
  tmpfile="$(kc_asdf_tags_list)"
  tmpfile="$(kc_asdf_tags_only "$tmpfile" "$filter")"
  tmpfile="$(kc_asdf_tags_format "$tmpfile" "$filter")"
  tmpfile="$(kc_asdf_tags_only "$tmpfile" "^\\s*$query")"
  command -v _kc_asdf_latest_filter >/dev/null &&
    tmpfile="$(_kc_asdf_latest_filter "$tmpfile" "$query")"
  tmpfile="$(kc_asdf_tags_stable "$tmpfile")"
  tmpfile="$(kc_asdf_tags_sort "$tmpfile")"
  kc_asdf_debug "final tags read from %s" "$tmpfile" &&
    tail -n1 "$tmpfile" &&
    kc_asdf_when_not_debug rm "$tmpfile"
}
